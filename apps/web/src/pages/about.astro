---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/homepage/Hero.astro";
import { getAboutPage } from "../lib/sanity/queries";
import { getSanityImageUrl } from "../lib/utils/sanity";
import { PortableText } from "astro-portabletext";
import CtaButton from "../components/common/CtaButton.astro";

// Fetch About Page Data
const aboutPage = await getAboutPage();

// SEO Fallbacks
const pageTitle = aboutPage?.seo?.title || aboutPage?.title || "About OLOPSC";
const pageDescription =
    aboutPage?.seo?.description ||
    "Learn about OLOPSC history, vision, and mission.";

const hero = aboutPage?.hero;
const identity = aboutPage?.identity;
const history = aboutPage?.history;
const vision = aboutPage?.vision;
const mission = aboutPage?.mission;
const strategicAgenda = aboutPage?.strategicAgenda;
const cta = aboutPage?.cta;
---

<Layout title={pageTitle} description={pageDescription}>
    {/* 1. Hero Section */}
    {hero && <Hero hero={hero} />}

    {/* 2. School Identity (Who We Are) */}
    {
        identity && (
            <section class="min-h-[60vh] px-5 py-10 sm:px-[60px] sm:py-[100px] bg-white">
                <div class="container mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                        <div class="order-2 md:order-1">
                            {identity.title && (
                                <h2 class="text-section-header-mobile sm:text-section-header-desktop text-[var(--color-primary)] mb-6">
                                    {identity.title}
                                </h2>
                            )}
                            {identity.content && (
                                <div class="prose text-main-mobile sm:text-main-desktop text-[var(--color-primary)]/80">
                                    <PortableText value={identity.content} />
                                </div>
                            )}
                        </div>
                        {identity.image?.asset?.url && (
                            <div class="order-1 md:order-2">
                                <div class="rounded-2xl overflow-hidden shadow-xl aspect-video relative">
                                    <img
                                        src={getSanityImageUrl(identity.image, {
                                            width: 800,
                                            height: 600,
                                            fit: "crop",
                                        })}
                                        alt={
                                            identity.image.alt ||
                                            identity.title ||
                                            ""
                                        }
                                        class="w-full h-full object-cover"
                                    />
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            </section>
        )
    }

    {/* 3. History Section */}
    {
        history && (
            <section class="min-h-[60vh] px-5 py-10 sm:px-[60px] sm:py-[100px] bg-[var(--color-neutral)]/30 border-y border-[var(--color-neutral)]/30">
                <div class="container mx-auto max-w-5xl">
                    <div class="text-center mb-16">
                        {history.title && (
                            <h2 class="text-section-header-mobile sm:text-section-header-desktop text-[var(--color-primary)] mb-6">
                                {history.title}
                            </h2>
                        )}
                        {history.content && (
                            <div class="prose max-w-3xl mx-auto text-main-mobile sm:text-main-desktop text-[var(--color-primary)]/80 text-justify">
                                <PortableText value={history.content} />
                            </div>
                        )}
                    </div>

                    {/* Timeline Preview (if available) - Simple List for now */}
                    {history.timeline && (
                        <div class="space-y-8 mt-12 relative border-l-2 border-[var(--color-accent)]/30 ml-4 md:ml-0 md:pl-0">
                            {/* Center Line for Desktop */}
                            <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-0.5 bg-[var(--color-accent)]/30 -translate-x-1/2" />

                            {history.timeline.map((item, index) => (
                                <div
                                    class={`relative md:flex items-center gap-8 ${index % 2 === 0 ? "md:flex-row-reverse" : ""}`}
                                >
                                    <div class="absolute left-[-21px] md:left-1/2 md:-translate-x-1/2 w-4 h-4 rounded-full bg-[var(--color-accent)] border-4 border-white shadow-sm z-10" />
                                    <div class="md:w-1/2 pl-8 md:pl-0 md:text-right p-4">
                                        <span class="text-[var(--color-accent)] font-bold text-xl block mb-1">
                                            {item.year}
                                        </span>
                                        {index % 2 !== 0 && (
                                            <div class="md:text-right">
                                                <h3 class="font-bold text-[var(--color-primary)] text-lg mb-2">
                                                    {item.title}
                                                </h3>
                                                <p class="text-[var(--color-primary)]/70 text-sm">
                                                    {item.description}
                                                </p>
                                            </div>
                                        )}
                                        {index % 2 === 0 && (
                                            <div class="md:hidden">
                                                <h3 class="font-bold text-[var(--color-primary)] text-lg mb-2">
                                                    {item.title}
                                                </h3>
                                                <p class="text-[var(--color-primary)]/70 text-sm">
                                                    {item.description}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                    <div class="md:w-1/2 pl-8 md:pl-0 p-4">
                                        {index % 2 === 0 && (
                                            <div class="md:text-left">
                                                <h3 class="hidden md:block font-bold text-[var(--color-primary)] text-lg mb-2">
                                                    {item.title}
                                                </h3>
                                                <p class="hidden md:block text-[var(--color-primary)]/70 text-sm">
                                                    {item.description}
                                                </p>
                                            </div>
                                        )}
                                        {index % 2 !== 0 && (
                                            <div class="md:hidden">
                                                <h3 class="font-bold text-[var(--color-primary)] text-lg mb-2">
                                                    {item.title}
                                                </h3>
                                                <p class="text-[var(--color-primary)]/70 text-sm">
                                                    {item.description}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </section>
        )
    }

    {/* 4. Vision & Mission */}
    {
        (vision || mission) && (
            <section class="min-h-[60vh] px-5 py-10 sm:px-[60px] sm:py-[100px] bg-white">
                <div class="container mx-auto">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-16">
                        {/* Vision */}
                        {vision && (
                            <div class="bg-[var(--color-primary)] rounded-3xl p-8 sm:p-12 text-white relative overflow-hidden group">
                                <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2 group-hover:scale-110 transition-transform duration-700" />
                                <h2 class="text-3xl font-serif font-bold mb-6 relative z-10">
                                    {vision.title || "Vision"}
                                </h2>
                                <div class="prose prose-invert text-lg relative z-10 opacity-90 leading-relaxed">
                                    <PortableText value={vision.content} />
                                </div>
                            </div>
                        )}

                        {/* Mission */}
                        {mission && (
                            <div class="bg-[var(--color-accent)] rounded-3xl p-8 sm:p-12 text-[var(--color-primary)] relative overflow-hidden group">
                                <div class="absolute bottom-0 left-0 w-64 h-64 bg-white/20 rounded-full translate-y-1/2 -translate-x-1/2 group-hover:scale-110 transition-transform duration-700" />
                                <h2 class="text-3xl font-serif font-bold mb-6 relative z-10">
                                    {mission.title || "Mission"}
                                </h2>
                                <div class="prose text-[var(--color-primary)] text-lg relative z-10 font-medium leading-relaxed">
                                    <PortableText value={mission.content} />
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            </section>
        )
    }

    {/* 5. Strategic Agenda */}
    {
        strategicAgenda && (
            <section class="min-h-[60vh] px-5 py-10 sm:px-[60px] sm:py-[100px] bg-[var(--color-neutral)]/20">
                <div class="container mx-auto max-w-6xl">
                    <div class="text-center mb-16">
                        {strategicAgenda.title && (
                            <h2 class="text-section-header-mobile sm:text-section-header-desktop text-[var(--color-primary)] mb-6">
                                {strategicAgenda.title}
                            </h2>
                        )}
                        {strategicAgenda.description && (
                            <p class="text-main-mobile sm:text-main-desktop text-[var(--color-primary)]/80 max-w-3xl mx-auto">
                                {strategicAgenda.description}
                            </p>
                        )}
                    </div>

                    {strategicAgenda.agendaItems && (
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                            {strategicAgenda.agendaItems.map((item, index) => (
                                <div class="bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border-t-4 border-[var(--color-accent)] group hover:-translate-y-1">
                                    <span class="text-4xl font-bold text-[var(--color-neutral)]/50 mb-3 block group-hover:text-[var(--color-accent)] transition-colors">
                                        {index + 1 < 10
                                            ? `0${index + 1}`
                                            : index + 1}
                                    </span>
                                    <p class="font-bold text-[var(--color-primary)] leading-tight">
                                        {typeof item === "string" ? item : item}
                                    </p>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </section>
        )
    }

    {/* 6. CTA / Final Section */}
    {
        cta && (
            <section class="px-5 py-20 sm:py-32 bg-[var(--color-primary)] text-white text-center">
                <div class="container mx-auto max-w-4xl">
                    <h2 class="text-3xl sm:text-5xl font-serif font-bold mb-8">
                        {cta.text}
                    </h2>
                    <div class="flex justify-center">
                        <CtaButton cta={cta} variant="secondary" />
                    </div>
                </div>
            </section>
        )
    }
</Layout>
