---
import { getSanityImageUrl } from "../../lib/utils/sanity";
import ScrollRevealWrapper from "../common/ScrollRevealWrapper.astro";

interface Props {
  gallery: {
    title?: string;
    images?: Array<{
      asset?: {
        _id?: string;
        url?: string;
        metadata?: {
          dimensions?: {
            width?: number;
            height?: number;
          };
        };
      };
      alt?: string;
      caption?: string;
    }>;
  };
}

const { gallery } = Astro.props;
---

{
  gallery && gallery.images && gallery.images.length === 6 && (
    <ScrollRevealWrapper direction="up" delay={0.1}>
      <section class="min-h-[60vh] px-5 py-10 sm:px-[60px] sm:py-[100px] bg-white border-t border-[var(--color-neutral)]/30">
        <div class="container mx-auto max-w-full flex flex-col justify-center">
          {gallery.title && (
            <div class="mb-6 sm:mb-8">
              <h2 class="text-section-header-mobile sm:text-section-header-desktop text-[var(--color-primary)] text-center">
                {gallery.title}
              </h2>
            </div>
          )}
          <div class="gallery-bento-grid max-w-6xl mx-auto gap-4 sm:gap-6">
            {gallery.images.map((image, index) => (
              <div
                class={`gallery-item bg-neutral rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-500 group gallery-item-${index + 1}`}
              >
                {image.asset?.url && (
                  <img
                    src={getSanityImageUrl(image, {
                      width: 800,
                      height: 600,
                      fit: "crop",
                    })}
                    alt={
                      image.alt || image.caption || `Gallery image ${index + 1}`
                    }
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 ease-[cubic-bezier(0.22,0.61,0.36,1)]"
                  />
                )}
                {image.caption && (
                  <div class="absolute bottom-0 left-0 right-0 bg-black/60 text-white p-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <p class="text-sm">{image.caption}</p>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </section>
    </ScrollRevealWrapper>
  )
}

<style>
  .gallery-bento-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-auto-rows: minmax(200px, auto);
    gap: 16px;
  }

  /* Mobile: 1-column grid */
  @media (max-width: 767px) {
    .gallery-bento-grid {
      grid-template-columns: 1fr;
      grid-auto-rows: minmax(250px, auto);
    }
    .gallery-item {
      grid-column: 1;
      grid-row: span 1;
    }
  }

  /* Tablet: 2-column grid with some bento styling */
  @media (min-width: 768px) and (max-width: 1023px) {
    .gallery-bento-grid {
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: minmax(250px, auto);
    }
    .gallery-item-1 {
      grid-column: span 2;
    }
    .gallery-item-4 {
      grid-column: span 2;
    }
  }

  /* Desktop: 3-column bento grid */
  @media (min-width: 1024px) {
    .gallery-bento-grid {
      grid-template-columns: repeat(3, 1fr);
      grid-auto-rows: minmax(280px, auto);
      gap: 24px;
    }
    .gallery-item-1 {
      grid-column: span 2;
      grid-row: span 2;
    }
    .gallery-item-2 {
      grid-column: 3;
      grid-row: span 1;
    }
    .gallery-item-3 {
      grid-column: 3;
      grid-row: span 1;
    }
    .gallery-item-4 {
      grid-column: 1;
      grid-row: span 1;
    }
    .gallery-item-5 {
      grid-column: 2;
      grid-row: span 1;
    }
    .gallery-item-6 {
      grid-column: 3;
      grid-row: span 1;
    }
  }

  .gallery-item {
    position: relative;
    animation: fadeInUp 0.6s ease-out forwards;
    opacity: 0;
  }

  .gallery-item:nth-child(1) {
    animation-delay: 0.1s;
  }
  .gallery-item:nth-child(2) {
    animation-delay: 0.2s;
  }
  .gallery-item:nth-child(3) {
    animation-delay: 0.3s;
  }
  .gallery-item:nth-child(4) {
    animation-delay: 0.4s;
  }
  .gallery-item:nth-child(5) {
    animation-delay: 0.5s;
  }
  .gallery-item:nth-child(6) {
    animation-delay: 0.6s;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
