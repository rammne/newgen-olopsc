---
import { formatDate, getSanityImageUrl } from "../../lib/utils/sanity";
import ScrollRevealWrapper from "../common/ScrollRevealWrapper.astro";

interface Props {
  news: Array<{
    _id?: string;
    title?: string;
    slug?: {
      current?: string;
    };
    publishedAt?: string;
    featuredImage?: {
      asset?: {
        url?: string;
      };
      alt?: string;
    };
    excerpt?: string;
    category?: string;
    featured?: boolean;
    academicDepartment?: {
      title?: string;
    };
  }>;
  title?: string;
}

const { news, title = "Department News" } = Astro.props;

const featuredNews = news.filter((n) => n.featured).slice(0, 3);
const nonFeaturedNews = news.filter((n) => !n.featured);
---

{
  (featuredNews.length > 0 || nonFeaturedNews.length > 0) && (
    <section class="min-h-[60vh] px-5 py-10 sm:px-[60px] sm:py-[100px] bg-white border-t border-[var(--color-neutral)]/30">
      <div class="container mx-auto w-full">
        <h2 class="text-section-header-mobile sm:text-section-header-desktop text-[var(--color-primary)] text-center mb-12">
          {title}
        </h2>

        {/* Featured News */}
        {featuredNews.length > 0 && (
          <div class="mb-12">
            <h3 class="text-2xl sm:text-3xl font-bold text-[var(--color-primary)] mb-6">
              Featured News
            </h3>
            {/* Mobile View: Compact List */}
            <div class="flex flex-col gap-4 md:hidden">
              {featuredNews.map((article) => (
                <a
                  href={`/news/${article.slug?.current || ""}`}
                  class="bg-white rounded-lg overflow-hidden shadow-sm flex items-center p-3 gap-4"
                >
                  {article.featuredImage?.asset?.url && (
                    <div class="w-24 h-24 flex-shrink-0 rounded-md overflow-hidden bg-[var(--color-neutral)]">
                      <img
                        src={getSanityImageUrl(article.featuredImage, {
                          width: 200,
                          height: 200,
                          fit: "crop",
                        })}
                        alt={article.featuredImage.alt || article.title || ""}
                        class="w-full h-full object-cover"
                      />
                    </div>
                  )}
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                      {article.category && (
                        <span class="text-[10px] text-[var(--color-accent)] font-bold uppercase tracking-wider">
                          {article.category}
                        </span>
                      )}
                      {article.publishedAt && (
                        <span class="text-[10px] text-[var(--color-primary)]/60">
                          {formatDate(article.publishedAt)}
                        </span>
                      )}
                    </div>
                    <h3 class="text-main-mobile text-[var(--color-primary)] font-bold leading-tight line-clamp-2 mb-1">
                      {article.title}
                    </h3>
                    <p class="text-small-mobile text-[var(--color-primary)]/70 line-clamp-1">
                      {article.academicDepartment?.title || "General"}
                    </p>
                  </div>
                </a>
              ))}
            </div>

            <div class="hidden md:grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {featuredNews.map((article) => (
                <a
                  href={`/news/${article.slug?.current || ""}`}
                  class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow group"
                >
                  {article.featuredImage?.asset?.url && (
                    <div class="aspect-video overflow-hidden">
                      <img
                        src={getSanityImageUrl(article.featuredImage, {
                          width: 400,
                          height: 300,
                          fit: "crop",
                        })}
                        alt={article.featuredImage.alt || article.title || ""}
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                    </div>
                  )}
                  <div class="p-6">
                    <div class="flex items-center gap-3 mb-2 flex-wrap">
                      {article.category && (
                        <span class="text-small-mobile sm:text-small-desktop text-[var(--color-accent)] font-semibold uppercase">
                          {article.category}
                        </span>
                      )}
                      <span class="text-small-mobile sm:text-small-desktop text-[var(--color-primary)]">
                        ‚≠ê Featured
                      </span>
                    </div>
                    <h3 class="text-card-title-mobile sm:text-card-title-desktop text-[var(--color-primary)] mb-2 group-hover:text-[var(--color-accent)] transition-colors">
                      {article.title}
                    </h3>
                    {article.publishedAt && (
                      <p class="text-small-mobile sm:text-small-desktop text-[var(--color-accent)] font-semibold mb-2">
                        {formatDate(article.publishedAt)}
                      </p>
                    )}
                    {article.academicDepartment?.title && (
                      <p class="text-main-mobile sm:text-main-desktop text-[var(--color-primary)] mb-2">
                        üìç {article.academicDepartment.title}
                      </p>
                    )}
                    {article.excerpt && (
                      <p class="text-main-mobile sm:text-main-desktop text-[var(--color-primary)] line-clamp-2">
                        {article.excerpt}
                      </p>
                    )}
                  </div>
                </a>
              ))}
            </div>
          </div>
        )}

        {/* Non-Featured News */}
        {nonFeaturedNews.length > 0 && (
          <div>
            <h3 class="text-2xl sm:text-3xl font-bold text-[var(--color-primary)] mb-6">
              All News
            </h3>
            {/* Mobile View: Compact List */}
            <div class="flex flex-col gap-4 md:hidden">
              {nonFeaturedNews.map((article) => (
                <a
                  href={`/news/${article.slug?.current || ""}`}
                  class="bg-white rounded-lg overflow-hidden shadow-sm flex items-center p-3 gap-4"
                >
                  {article.featuredImage?.asset?.url && (
                    <div class="w-24 h-24 flex-shrink-0 rounded-md overflow-hidden bg-[var(--color-neutral)]">
                      <img
                        src={getSanityImageUrl(article.featuredImage, {
                          width: 200,
                          height: 200,
                          fit: "crop",
                        })}
                        alt={article.featuredImage.alt || article.title || ""}
                        class="w-full h-full object-cover"
                      />
                    </div>
                  )}
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                      {article.category && (
                        <span class="text-[10px] text-[var(--color-accent)] font-bold uppercase tracking-wider">
                          {article.category}
                        </span>
                      )}
                      {article.publishedAt && (
                        <span class="text-[10px] text-[var(--color-primary)]/60">
                          {formatDate(article.publishedAt)}
                        </span>
                      )}
                    </div>
                    <h3 class="text-main-mobile text-[var(--color-primary)] font-bold leading-tight line-clamp-2 mb-1">
                      {article.title}
                    </h3>
                    <p class="text-small-mobile text-[var(--color-primary)]/70 line-clamp-1">
                      {article.academicDepartment?.title || "General"}
                    </p>
                  </div>
                </a>
              ))}
            </div>

            <div class="hidden md:grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {nonFeaturedNews.map((article) => (
                <a
                  href={`/news/${article.slug?.current || ""}`}
                  class="bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow group"
                >
                  {article.featuredImage?.asset?.url && (
                    <div class="aspect-video overflow-hidden">
                      <img
                        src={getSanityImageUrl(article.featuredImage, {
                          width: 400,
                          height: 300,
                          fit: "crop",
                        })}
                        alt={article.featuredImage.alt || article.title || ""}
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                    </div>
                  )}
                  <div class="p-6">
                    <div class="flex items-center gap-3 mb-2 flex-wrap">
                      {article.category && (
                        <span class="text-small-mobile sm:text-small-desktop text-[var(--color-accent)] font-semibold uppercase">
                          {article.category}
                        </span>
                      )}
                    </div>
                    <h3 class="text-card-title-mobile sm:text-card-title-desktop text-[var(--color-primary)] mb-2 group-hover:text-[var(--color-accent)] transition-colors">
                      {article.title}
                    </h3>
                    {article.publishedAt && (
                      <p class="text-small-mobile sm:text-small-desktop text-[var(--color-accent)] font-semibold mb-2">
                        {formatDate(article.publishedAt)}
                      </p>
                    )}
                    {article.academicDepartment?.title && (
                      <p class="text-main-mobile sm:text-main-desktop text-[var(--color-primary)] mb-2">
                        üìç {article.academicDepartment.title}
                      </p>
                    )}
                    {article.excerpt && (
                      <p class="text-main-mobile sm:text-main-desktop text-[var(--color-primary)] line-clamp-2">
                        {article.excerpt}
                      </p>
                    )}
                  </div>
                </a>
              ))}
            </div>
          </div>
        )}
      </div>
    </section>
  )
}
