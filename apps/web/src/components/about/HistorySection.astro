---
import { PortableText } from "astro-portabletext";

interface Props {
    history: {
        title?: string;
        content?: any[];
        timeline?: Array<{
            year?: string;
            title?: string;
            description?: string;
            image?: {
                asset?: {
                    url?: string;
                };
                alt?: string;
            };
        }>;
    };
}

const { history } = Astro.props;

if (!history) return null;
---

<section
    class="min-h-[60vh] px-5 py-10 sm:px-[60px] sm:py-[100px] bg-[var(--color-neutral)]/30"
>
    <div class="container mx-auto">
        <div class="text-center max-w-3xl mx-auto mb-16">
            <h2
                class="text-section-header-mobile sm:text-section-header-desktop font-serif text-[var(--color-primary)] mb-6"
            >
                {history.title || "Our History"}
            </h2>
            {
                history.content && (
                    <div class="text-main-mobile sm:text-main-desktop text-gray-700">
                        <PortableText value={history.content} />
                    </div>
                )
            }
        </div>

        {
            history.timeline && (
                <div class="relative space-y-12">
                    {/* Vertical Line */}
                    <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-0.5 bg-[var(--color-primary)]/20 -translate-x-1/2" />

                    {history.timeline.map((event, index) => (
                        <div
                            class={`relative flex flex-col md:flex-row gap-8 items-center ${index % 2 === 1 ? "md:flex-row-reverse" : ""}`}
                        >
                            {/* Date Marker (Desktop) */}
                            <div class="hidden md:flex absolute left-1/2 -translate-x-1/2 items-center justify-center w-12 h-12 rounded-full bg-white border-4 border-[var(--color-primary)] z-10 font-bold text-[var(--color-primary)] text-sm shadow-md">
                                <div class="w-3 h-3 bg-[var(--color-accent)] rounded-full" />
                            </div>

                            {/* Content Side */}
                            <div class="w-full md:w-1/2 md:pr-12 last:md:pl-12">
                                <div
                                    class={`bg-white p-6 rounded-xl shadow-md border-t-4 border-[var(--color-primary)] hover:shadow-lg transition-shadow duration-300 ${index % 2 === 1 ? "md:mr-auto" : "md:ml-auto"}`}
                                >
                                    <span class="inline-block px-3 py-1 bg-[var(--color-primary)]/10 text-[var(--color-primary)] text-sm font-bold rounded-full mb-3">
                                        {event.year}
                                    </span>
                                    <h3 class="text-card-title-mobile sm:text-xl font-bold text-[var(--color-primary)] mb-3">
                                        {event.title}
                                    </h3>
                                    <p class="text-small-mobile sm:text-small-desktop text-gray-600">
                                        {event.description}
                                    </p>
                                </div>
                            </div>

                            {/* Empty Side for layout balance on Desktop */}
                            <div class="hidden md:block w-1/2" />
                        </div>
                    ))}
                </div>
            )
        }
    </div>
</section>
