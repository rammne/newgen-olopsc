---
import {contactFormSchema, type ContactFormData} from '../../lib/validation/schemas'
import {validateFormData, formatZodErrors} from '../../lib/validation/utils'
import Icon from '../icons/Icon.astro'

interface Props {
  action?: string
  method?: 'GET' | 'POST'
}

const {action = '/api/contact', method = 'POST'} = Astro.props

let errors: Record<string, string> = {}
let success = false
let submitted = false

if (Astro.request.method === 'POST') {
  submitted = true
  const formData = await Astro.request.formData()
  const result = validateFormData(contactFormSchema, formData)
  
  if (!result.success) {
    errors = formatZodErrors(result.error)
  } else {
    // Here you would typically send the data to your API
    // For now, we'll just set success to true
    success = true
  }
}
---

<form method={method} action={action} class="contact-form">
  {success && (
    <div class="success-message">
      <Icon name="check-circle" size={20} />
      <span>Thank you! Your message has been sent successfully.</span>
    </div>
  )}
  
  <div class="form-group">
    <label for="name">
      Name <span class="required">*</span>
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
      aria-invalid={errors.name ? 'true' : 'false'}
      aria-describedby={errors.name ? 'name-error' : undefined}
    />
    {errors.name && (
      <span id="name-error" class="error-message">
        <Icon name="alert-circle" size={16} />
        {errors.name}
      </span>
    )}
  </div>
  
  <div class="form-group">
    <label for="email">
      Email <span class="required">*</span>
    </label>
    <input
      type="email"
      id="email"
      name="email"
      required
      aria-invalid={errors.email ? 'true' : 'false'}
      aria-describedby={errors.email ? 'email-error' : undefined}
    />
    {errors.email && (
      <span id="email-error" class="error-message">
        <Icon name="alert-circle" size={16} />
        {errors.email}
      </span>
    )}
  </div>
  
  <div class="form-group">
    <label for="phone">Phone</label>
    <input
      type="tel"
      id="phone"
      name="phone"
      aria-invalid={errors.phone ? 'true' : 'false'}
      aria-describedby={errors.phone ? 'phone-error' : undefined}
    />
    {errors.phone && (
      <span id="phone-error" class="error-message">
        <Icon name="alert-circle" size={16} />
        {errors.phone}
      </span>
    )}
  </div>
  
  <div class="form-group">
    <label for="subject">
      Subject <span class="required">*</span>
    </label>
    <input
      type="text"
      id="subject"
      name="subject"
      required
      aria-invalid={errors.subject ? 'true' : 'false'}
      aria-describedby={errors.subject ? 'subject-error' : undefined}
    />
    {errors.subject && (
      <span id="subject-error" class="error-message">
        <Icon name="alert-circle" size={16} />
        {errors.subject}
      </span>
    )}
  </div>
  
  <div class="form-group">
    <label for="message">
      Message <span class="required">*</span>
    </label>
    <textarea
      id="message"
      name="message"
      rows="6"
      required
      aria-invalid={errors.message ? 'true' : 'false'}
      aria-describedby={errors.message ? 'message-error' : undefined}
    ></textarea>
    {errors.message && (
      <span id="message-error" class="error-message">
        <Icon name="alert-circle" size={16} />
        {errors.message}
      </span>
    )}
  </div>
  
  <button type="submit" class="submit-button">
    <Icon name="send" size={20} />
    Send Message
  </button>
</form>

<style>
  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    max-width: 600px;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  label {
    font-weight: 600;
    color: var(--color-text, #1a1a1a);
  }
  
  .required {
    color: var(--color-error, #dc2626);
  }
  
  input,
  textarea {
    padding: 0.75rem;
    border: 1px solid var(--color-border, #d1d5db);
    border-radius: 0.375rem;
    font-size: 1rem;
    transition: border-color 0.2s;
  }
  
  input:focus,
  textarea:focus {
    outline: none;
    border-color: var(--color-primary, #3b82f6);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  input[aria-invalid='true'],
  textarea[aria-invalid='true'] {
    border-color: var(--color-error, #dc2626);
  }
  
  .error-message {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    color: var(--color-error, #dc2626);
    font-size: 0.875rem;
  }
  
  .success-message {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    background-color: var(--color-success-bg, #d1fae5);
    color: var(--color-success, #065f46);
    border-radius: 0.375rem;
    font-weight: 500;
  }
  
  .submit-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background-color: var(--color-primary, #3b82f6);
    color: white;
    border: none;
    border-radius: 0.375rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
  }
  
  .submit-button:hover {
    background-color: var(--color-primary-dark, #2563eb);
  }
  
  .submit-button:active {
    transform: scale(0.98);
  }
</style>

