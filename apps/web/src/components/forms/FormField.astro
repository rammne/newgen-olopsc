---
import Icon from '../icons/Icon.astro'

interface Props {
  label: string
  name: string
  type?: 'text' | 'email' | 'tel' | 'textarea' | 'select' | 'checkbox' | 'radio' | 'date' | 'file'
  required?: boolean
  error?: string
  placeholder?: string
  value?: string
  options?: Array<{value: string; label: string}>
  rows?: number
  class?: string
}

const {
  label,
  name,
  type = 'text',
  required = false,
  error,
  placeholder,
  value,
  options = [],
  rows = 4,
  class: className = '',
} = Astro.props

const fieldId = `field-${name}`
const errorId = error ? `${fieldId}-error` : undefined
---

<div class={`form-field ${className}`}>
  <label for={fieldId}>
    {label}
    {required && <span class="required">*</span>}
  </label>
  
  {type === 'textarea' ? (
    <textarea
      id={fieldId}
      name={name}
      required={required}
      placeholder={placeholder}
      rows={rows}
      aria-invalid={error ? 'true' : 'false'}
      aria-describedby={errorId}
    >
      {value || ''}
    </textarea>
  ) : type === 'select' ? (
    <select
      id={fieldId}
      name={name}
      required={required}
      aria-invalid={error ? 'true' : 'false'}
      aria-describedby={errorId}
    >
      <option value="">{placeholder || 'Select an option'}</option>
      {options.map((option) => (
        <option value={option.value} selected={value === option.value}>
          {option.label}
        </option>
      ))}
    </select>
  ) : type === 'checkbox' ? (
    <div class="checkbox-group">
      <input
        type="checkbox"
        id={fieldId}
        name={name}
        checked={value === 'true' || value === 'on'}
        aria-invalid={error ? 'true' : 'false'}
        aria-describedby={errorId}
      />
      <label for={fieldId} class="checkbox-label">
        {label}
      </label>
    </div>
  ) : (
    <input
      type={type}
      id={fieldId}
      name={name}
      required={required}
      placeholder={placeholder}
      value={value}
      aria-invalid={error ? 'true' : 'false'}
      aria-describedby={errorId}
    />
  )}
  
  {error && (
    <span id={errorId} class="error-message" role="alert">
      <Icon name="alert-circle" size={16} />
      {error}
    </span>
  )}
</div>

<style>
  .form-field {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  label {
    font-weight: 600;
    color: var(--color-text, #1a1a1a);
    font-size: 0.875rem;
  }
  
  .required {
    color: var(--color-error, #dc2626);
    margin-left: 0.25rem;
  }
  
  input,
  textarea,
  select {
    padding: 0.75rem;
    border: 1px solid var(--color-border, #d1d5db);
    border-radius: 0.375rem;
    font-size: 1rem;
    font-family: inherit;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  
  input:focus,
  textarea:focus,
  select:focus {
    outline: none;
    border-color: var(--color-primary, #3b82f6);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  input[aria-invalid='true'],
  textarea[aria-invalid='true'],
  select[aria-invalid='true'] {
    border-color: var(--color-error, #dc2626);
  }
  
  .checkbox-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .checkbox-label {
    font-weight: normal;
    cursor: pointer;
  }
  
  .error-message {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    color: var(--color-error, #dc2626);
    font-size: 0.875rem;
  }
</style>

